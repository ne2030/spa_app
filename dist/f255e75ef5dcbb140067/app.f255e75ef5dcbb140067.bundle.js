!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="dist/f255e75ef5dcbb140067",t(0)}([function(e,t,n){"use strict";var r=n(1),o=n(2),s=n(3)(),a=80,i=3002;if(n(42)(),"development"==process.env.NODE_ENV){console.log("Server is running on development");var u=n(45),c=r(u),l=new o(c,u.devServer);l.listen(i,function(){console.log("webpack-dev-server is listening on port",i)})}s.listen(a,function(){return console.log("production server is running on port"+a)})},function(e,t){e.exports=require("webpack")},function(e,t){e.exports=require("webpack-dev-server")},function(e,t,n){(function(t){"use strict";var r=n(4),o=n(5),s=n(6),a=n(7),i=n(8),u=n(9),c=n(10);e.exports=function(){var e=o();e.use(s.json()),e.use(s.urlencoded({extended:!1})),e.use(a());var l=["http://52.78.225.119","http://localhost","http://localhost:8000","http://eleclion.asia","http://localhost:3000","http://localhost:9000"],p={origin:function(e,t){var n=l.indexOf(e)!==-1;t(null,n)},credentials:!0};e.use(i(p)),e.use(o.static(r.join(t,"../public"))),e.use(o.static(r.join(t,"../app"))),e.use(o.static(r.join(t,"../front/build"))),e.use(function(e,t,n){try{if(!e.headers||!e.headers.authorization)return n();if(!/^Bearer/.test(e.headers.authorization))return n();var r=e.headers.authorization.split(" ")[1],o=c.authenticateToken(r,n);if(o.error)return n();e.user=o,n()}catch(e){n(e)}});var d=o.Router(),f=n(16)(d),h=n(31)(d),v=n(33)(d),y=n(35)(d),x={chat:f,list:h,profile:v,users:y};for(var m in x)e.use(x[m]);return e.use(u),e}}).call(t,"/")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express-validator")},function(e,t){e.exports=require("cors")},function(e,t){"use strict";e.exports=function(e,t,n,r){if(!e)return r();console.log(e);var o=t.originalMethod||t.method;return n.headersSent?r():void n.status(e.statusCode||500).send({message:e.message,body:t.body,url:t.originalUrl,route:o})}},function(e,t,n){"use strict";var r=n(11),o=n(12);e.exports.core=r,e.exports.generateToken=function(e,t,n){try{var s={algorithm:"HS256",expiresIn:"3h",issuer:o.sessionIssuer,audience:t},a=r.sign(e,o.sessionSecret,s);return console.log(a),a}catch(e){return n(e)}},e.exports.authenticateToken=function(e,t){try{var n={algorithm:"HS256",expiresIn:"3h",issuer:o.sessionIssuer,audience:t},s=r.verify(e,o.sessionSecret,n);return s}catch(e){return e.error="error",e}}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=new RegExp("^(?:[a-z]+:)?//","i"),r=[];if(Array.isArray(e))e.forEach(function(e){r=r.concat(o(e,t))});else if("string"==typeof e)if(n.test(e))r.push(e);else{var s=i(e,{sync:!0});t&&(s=s.map(function(e){return e.replace(t,"")})),r=r.concat(s)}return r}var s=n(13),a=r(s),i=n(14);e.exports=(0,a.default)({},n(15)),e.exports.getGlobbedFiles=o},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("glob")},function(e,t){"use strict";e.exports={sessionIssuer:"eleclion.asia",sessionSecret:"My FeElInGs FoR yOu",tokenSecret:"I cOuLd Be ThE oNe"}},function(e,t,n){"use strict";var r=n(17);e.exports=function(e){return e.route("/api/chat").get(r.getChat).post(r.createChat),e.route("/api/chat/:chatId").delete(r.deleteChat),e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(18),s=r(o),a=n(13),i=r(a),u=n(19),c=n(20),l=n(29),p=c.Chat;e.exports.getChat=function(e,t,n){u(s.default.mark(function r(){var o,a,u,c,d,f;return s.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,a=e.query.page?parseInt(e.query.page):0,u=20,r.next=5,p.findAndCountAll({offset:a,limit:u,order:"id desc"});case 5:c=r.sent,d=c.rows.map(function(e){var t=e.createdAt.getHours(),n=t/12>1?"오후 "+t%12:"오전 "+t,r=n+":"+e.createdAt.getMinutes();return(0,i.default)(e.dataValues,{time:r})}),f=l.pagenation({req:e,size:u,totalCount:c.count,currentRowCount:c.rows.length}),o=(0,i.default)({count:c.count,chat:d},f),t.send(o),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),n(r.t0);case 15:case"end":return r.stop()}},r,this,[[0,12]])}))},e.exports.deleteChat=function(e,t,n){u(s.default.mark(function r(){var o;return s.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o=e.params.chatId,r.next=4,p.destroy({where:{id:o}});case 4:t.end(),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),n(r.t0);case 10:case"end":return r.stop()}},r,this,[[0,7]])}))},e.exports.createChat=function(e,t,n){u(s.default.mark(function r(){var o,a,i;return s.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e.checkBody("name","이름을 입력해주세요").notEmpty(),e.checkBody("content","내용을 입력해주세요").notEmpty(),o=e.validationErrors()){r.next=17;break}return r.prev=4,a=e.body.name,i=e.body.content,r.next=9,p.create({name:a,content:i});case 9:t.end(),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(4),n(r.t0);case 15:r.next=18;break;case 17:t.send(o[0]);case 18:case"end":return r.stop()}},r,this,[[4,12]])}))}},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("co")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(13),s=r(o),a=n(21),i=n(4),u=n(22),c={},l=new a("spaApp","root","",{host:"127.0.0.1",dialect:"mysql",port:3306}),p="/Users/gyeonghun/Documents/projects/spa_app/app/models";u.readdirSync(p).forEach(function(e){console.log("Loading model file "+e);var t=l.import(i.join(p,e));c[t.name]=t}),l.authenticate().then(function(){return console.log("Connection has been established successfully.")},function(e){return console.log("Unable to connect to the database:",e)}),n(23),n(24),n(25),n(26),n(27);for(var d in c)c[d].options.associate&&c[d].options.associate(c);e.exports=(0,s.default)({sequelize:l,Sequelize:a},c)},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var r=n(21);e.exports=function(e){var t=e.define("Chat",{name:{type:r.STRING(10),allowNull:!1},content:{type:r.STRING(255),allowNull:!1}},{paranoid:!0});return t}},function(e,t,n){"use strict";var r=n(21);e.exports=function(e){var t=e.define("Profile",{skill:{type:r.STRING(10),allowNull:!1},type:{type:r.STRING(10),allowNull:!1},description:{type:r.STRING(255),allowNull:!1},mastery:{type:r.INTEGER(3),allowNull:!1}},{paranoid:!0});return t}},function(e,t){"use strict";e.exports=function(e,t){var n=e.define("RefreshToken",{refreshToken:{type:t.STRING,allowNull:!1,unique:!0},expiredAt:{type:t.DATE,allowNull:!1}},{associate:function(e){n.belongsTo(e.User,{foreignKey:{allowNull:!1}})}});return n}},function(e,t,n){"use strict";var r=n(21);e.exports=function(e){var t=e.define("Route2",{name:{type:r.STRING(10),allowNull:!0},content:{type:r.STRING(255),allowNull:!1}},{paranoid:!0});return t}},function(e,t,n){"use strict";var r=n(21),o=n(28);e.exports=function(e){function t(e){if(e&&e.password&&"string"==typeof e.password){if(!(e.password.length>=6&&e.password.length<=4096))throw{message:"비밀번호 길이를 체크해주십시오"};e.password=e.hashPassword(e.password)}}var n=e.define("User",{email:{type:r.STRING(255),allowNull:!1},password:{type:r.STRING,allowNull:!1},phone:{type:r.STRING,allowNull:!1},rolse:{type:r.STRING},age:{type:r.INTEGER(3),allowNull:!1},resetPasswordToken:{type:r.STRING,unique:!0},resetPasswordExpires:{type:r.DATE},lastSignIn:{type:r.DATE}},{paranoid:!0,instanceMethods:{authenticate:function(e){return o.compareSync(e,this.password)},hashPassword:function(e){var t=o.genSaltSync(10);return o.hashSync(e,t)}}});return n.beforeCreate(t),n.beforeUpdate(t),n}},function(e,t){e.exports=require("bcrypt")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(30),s=r(o),a=n(12);e.exports.pagenation=function(e){function t(e){var t=(0,s.default)(e).map(function(t){return t+"="+e[t]}).join("&");return a.endPoint+n+"?"+t}e.req=e.req||{};var n=e.req._parsedOriginalUrl.pathname||"",r=e.req.query||{},o=e.size||20,i=parseInt(r.page)||0,u=e.totalCount||0,c=e.currentRowCount||0,l=null,p=null;if(0!==i){var d=i-o;d=d<0?0:d,r.page=d,l=t(r)}return c==o&&i+c!=u&&(r.page=i+o,p=t(r)),{prev:l,next:p}}},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t,n){"use strict";var r=n(32);e.exports=function(e){return e.route("/api/route2").get(r.getRoute2).post(r.makeItem),e.route("/api/route2/:itemId").delete(r.deleteItem),e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(18),s=r(o),a=n(20),i=n(19),u=a.Route2;e.exports.getRoute2=function(e,t,n){u.findAndCountAll({attributes:["id","name","content","createdAt"],order:"id desc"}).then(function(e){e={id:e.id,count:e.count,items:e.rows},t.send(e)}).catch(n)},e.exports.makeItem=function(e,t,n){var r=e.body.name,o=e.body.chat;u.create({name:r,content:o}).then(function(e){t.send(e)}).catch(n)},e.exports.deleteItem=function(e,t,n){i(s.default.mark(function r(){var o;return s.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o=e.params.itemId,r.next=4,u.destroy({where:{id:o}});case 4:t.end(),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),n(r.t0);case 10:case"end":return r.stop()}},r,this,[[0,7]])}))}},function(e,t,n){"use strict";var r=n(34);e.exports=function(e){return e.route("/api/stack").get(r.getStack).post(r.createStack),e}},function(e,t,n){"use strict";var r=n(20),o=r.Profile;e.exports.getStack=function(e,t,n){o.findAndCountAll({attributes:["id","skill","type","description","mastery"]}).then(function(e){return t.send(e.rows)}).catch(function(e){return n(e)})},e.exports.createStack=function(e,t,n){e.checkBody("skill","스킬을 입력해주세요").notEmpty(),e.checkBody("type","종류를 입력해주세요").notEmpty(),e.checkBody("description","설명을 입력해주세요").notEmpty(),e.checkBody("mastery","숙련도를 입력해주세요").notEmpty();var r=e.validationErrors();if(r)return void t.send(r[0]);var s=e.body.skill,a=e.body.type,i=e.body.description,u=e.body.mastery;o.create({skill:s,type:a,description:i,mastery:u}).then(function(e){return t.send(e)}).catch(function(e){return n(e)})}},function(e,t,n){"use strict";var r=n(36);e.exports=function(e){return e.route("/auth/login").post(r.login),e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(13),s=r(o);e.exports=(0,s.default)({},n(37),n(39),n(40),n(41))},function(e,t,n){"use strict";function r(){var e=s.genSaltSync(10);return s.hashSync(i.tokenSecret,e)}var o=n(38),s=n(28),a=n(10),i=n(12),u=n(20),c=u.RefreshToken;e.exports.login=function(e,t,n){e.checkBody("userEmail","이메일을 입력해주세요").notEmpty(),e.checkBody("password","패스워드를 입력해주세요").notEmpty();var s=e.validationErrors();s?t.send(s[0]):o.authenticate("local",function(o,s,i){o||!s?n({message:i.message||o.message,statusCode:401}):!function(){var o=r();c.create({refreshToken:o,expiredAt:Date.now()+2592e6,UserId:s.id}).then(function(){var r={id:s.id,email:s.email},i=a.generateToken(r,e.hostname,n);t.send({refreshToken:o,jwToken:i,user:s.email})})}()})(e,t,n)}},function(e,t){e.exports=require("passport")},function(e,t){"use strict"},function(e,t){"use strict";"추후 가능할 때 추가 작업 (user info 관련된 부분)"},function(e,t){"use strict"},function(e,t,n){"use strict";e.exports=function(){n(43)}},function(e,t,n){"use strict";var r=n(38),o=n(44).Strategy,s=n(20),a=s.User;e.exports=function(){r.use(new o({usernameField:"userEmail",passwordField:"password"},function(e,t,n){a.findOne({where:{email:e}}).then(function(e){return e?e.authenticate(t)?n(null,e):n(null,!1,{message:"비밀번호가 틀렸습니다."}):n(null,!1,{message:"등록된 아이디가 아닙니다."})}).catch(function(e){console.log(e),n(e)})}))}},function(e,t){e.exports=require("passport-local")},function(e,t,n){"use strict";var r=n(1),o=n(46);e.exports={target:"node",externals:[o()],node:{__dirname:!1},entry:["./server.js","webpack-dev-server/client?http://0.0.0.0:3002","webpack/hot/only-dev-server"],output:{path:"/",filename:"app.js"},devServer:{hot:!0,filename:"app.js",publicPath:"/",historyApiFallback:!0,contentBase:"./dist",proxy:{"**":"http://localhost:8000"}},plugins:[new r.optimize.OccurenceOrderPlugin,new r.HotModuleReplacementPlugin,new r.NoErrorsPlugin],module:{loaders:[{test:/\.js$/,loader:"babel",exclude:/node_modules/,query:{cacheDirectory:!0,presets:["es2015"]}}]}}},function(e,t){e.exports=require("webpack-node-externals")}]);
//# sourceMappingURL=app.f255e75ef5dcbb140067.bundle.js.map