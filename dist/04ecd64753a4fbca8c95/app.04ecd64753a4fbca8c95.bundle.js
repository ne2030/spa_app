!function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="dist/04ecd64753a4fbca8c95",t(0)}([function(e,t,r){"use strict";var n=r(1),o=r(2),s=r(3)(),a=80,i=3002;if(r(43)(),"development"==process.env.NODE_ENV){console.log("Server is running on development");var u=r(46),c=n(u),l=new o(c,u.devServer);l.listen(i,function(){console.log("webpack-dev-server is listening on port",i)})}s.listen(a,function(){return console.log("production server is running on port"+a)})},function(e,t){e.exports=require("webpack")},function(e,t){e.exports=require("webpack-dev-server")},function(e,t,r){"use strict";var n=r(4),o=r(5),s=r(6),a=r(7),i=r(8),u=r(9),c=r(10);e.exports=function(){var e=o();e.use(s.json()),e.use(s.urlencoded({extended:!1})),e.use(a());var t=["http://52.78.225.119","http://localhost","http://localhost:8000","http://eleclion.org"],l={origin:function(e,r){var n=t.indexOf(e)!==-1;r(null,n)},credentials:!0};e.use(i(l)),e.use(o.static(n.join(__dirname,"../public"))),e.use(o.static(n.join(__dirname,"../app"))),e.use(o.static(n.join(__dirname,"../front/build"))),e.use(function(e,t,r){try{if(!e.headers||!e.headers.authorization)return r();if(!/^Bearer/.test(e.headers.authorization))return r();var n=e.headers.authorization.split(" ")[1],o=c.authenticateToken(n,r);if(o.error)return r();e.user=o,r()}catch(e){r(e)}});var p=o.Router(),d=r(16)(p),f=r(32)(p),h=r(34)(p),v=r(36)(p),y={chat:d,list:f,profile:h,users:v};for(var m in y)e.use(y[m]);return e.use(u),e}},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express-validator")},function(e,t){e.exports=require("cors")},function(e,t){"use strict";e.exports=function(e,t,r,n){if(!e)return n();console.log(e);var o=t.originalMethod||t.method;return r.headersSent?n():void r.status(e.statusCode||500).send({message:e.message,body:t.body,url:t.originalUrl,route:o})}},function(e,t,r){"use strict";var n=r(11),o=r(12);e.exports.core=n,e.exports.generateToken=function(e,t,r){try{var s={algorithm:"HS256",expiresIn:"3h",issuer:o.sessionIssuer,audience:t},a=n.sign(e,o.sessionSecret,s);return console.log(a),a}catch(e){return r(e)}},e.exports.authenticateToken=function(e,t){try{var r={algorithm:"HS256",expiresIn:"3h",issuer:o.sessionIssuer,audience:t},s=n.verify(e,o.sessionSecret,r);return s}catch(e){return e.error="error",e}}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var r=new RegExp("^(?:[a-z]+:)?//","i"),n=[];if(Array.isArray(e))e.forEach(function(e){n=n.concat(o(e,t))});else if("string"==typeof e)if(r.test(e))n.push(e);else{var s=i(e,{sync:!0});t&&(s=s.map(function(e){return e.replace(t,"")})),n=n.concat(s)}return n}var s=r(13),a=n(s),i=r(14);e.exports=(0,a.default)({},r(15)),e.exports.getGlobbedFiles=o},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("glob")},function(e,t){"use strict";e.exports={sessionIssuer:"eleclion.asia",sessionSecret:"My FeElInGs FoR yOu",tokenSecret:"I cOuLd Be ThE oNe"}},function(e,t,r){"use strict";var n=r(17);e.exports=function(e){return e.route("/api/chat").get(n.getChat).post(n.createChat),e.route("/api/chat/:chatId").delete(n.deleteChat),e}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=r(18),s=n(o),a=r(13),i=n(a),u=r(19),c=r(20),l=r(30),p=c.Chat;e.exports.getChat=function(e,t,r){u(s.default.mark(function n(){var o,a,u,c,d,f;return s.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a=e.query.page?parseInt(e.query.page):0,u=20,n.next=5,p.findAndCountAll({offset:a,limit:u,order:"id desc"});case 5:c=n.sent,d=c.rows.map(function(e){var t=e.createdAt.getHours(),r=t/12>1?"오후 "+t%12:"오전 "+t,n=r+":"+e.createdAt.getMinutes();return(0,i.default)(e.dataValues,{time:n})}),f=l.pagenation({req:e,size:u,totalCount:c.count,currentRowCount:c.rows.length}),o=(0,i.default)({count:c.count,chat:d},f),t.send(o),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(0),r(n.t0);case 15:case"end":return n.stop()}},n,this,[[0,12]])}))},e.exports.deleteChat=function(e,t,r){u(s.default.mark(function n(){var o;return s.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o=e.params.chatId,n.next=4,p.destroy({where:{id:o}});case 4:t.end(),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),r(n.t0);case 10:case"end":return n.stop()}},n,this,[[0,7]])}))},e.exports.createChat=function(e,t,r){u(s.default.mark(function n(){var o,a,i;return s.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.checkBody("name","이름을 입력해주세요").notEmpty(),e.checkBody("content","내용을 입력해주세요").notEmpty(),o=e.validationErrors()){n.next=17;break}return n.prev=4,a=e.body.name,i=e.body.content,n.next=9,p.create({name:a,content:i});case 9:t.end(),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(4),r(n.t0);case 15:n.next=18;break;case 17:t.send(o[0]);case 18:case"end":return n.stop()}},n,this,[[4,12]])}))}},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("co")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=r(13),s=n(o),a=r(21),i=r(4),u=r(22),c={},l=new a("spaApp","root","",{host:"127.0.0.1",dialect:"mysql",port:3306}),p=r(23).root,d=p+"/app/models";u.readdirSync(d).forEach(function(e){console.log("Loading model file "+e);var t=l.import(i.join(d,e));c[t.name]=t}),l.authenticate().then(function(){return console.log("Connection has been established successfully.")},function(e){return console.log("Unable to connect to the database:",e)}),r(24),r(25),r(26),r(27),r(28);for(var f in c)c[f].options.associate&&c[f].options.associate(c);e.exports=(0,s.default)({sequelize:l,Sequelize:a},c)},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";var n=r(4),o=n.normalize(__dirname+"/../..");console.log(o),e.exports={root:o}},function(e,t,r){"use strict";var n=r(21);e.exports=function(e){var t=e.define("Chat",{name:{type:n.STRING(10),allowNull:!1},content:{type:n.STRING(255),allowNull:!1}},{paranoid:!0});return t}},function(e,t,r){"use strict";var n=r(21);e.exports=function(e){var t=e.define("Profile",{skill:{type:n.STRING(10),allowNull:!1},type:{type:n.STRING(10),allowNull:!1},description:{type:n.STRING(255),allowNull:!1},mastery:{type:n.INTEGER(3),allowNull:!1}},{paranoid:!0});return t}},function(e,t){"use strict";e.exports=function(e,t){var r=e.define("RefreshToken",{refreshToken:{type:t.STRING,allowNull:!1,unique:!0},expiredAt:{type:t.DATE,allowNull:!1}},{associate:function(e){r.belongsTo(e.User,{foreignKey:{allowNull:!1}})}});return r}},function(e,t,r){"use strict";var n=r(21);e.exports=function(e){var t=e.define("Route2",{name:{type:n.STRING(10),allowNull:!0},content:{type:n.STRING(255),allowNull:!1}},{paranoid:!0});return t}},function(e,t,r){"use strict";var n=r(21),o=r(29);e.exports=function(e){function t(e){if(e&&e.password&&"string"==typeof e.password){if(!(e.password.length>=6&&e.password.length<=4096))throw{message:"비밀번호 길이를 체크해주십시오"};e.password=e.hashPassword(e.password)}}var r=e.define("User",{email:{type:n.STRING(255),allowNull:!1},password:{type:n.STRING,allowNull:!1},phone:{type:n.STRING,allowNull:!1},rolse:{type:n.STRING},age:{type:n.INTEGER(3),allowNull:!1},resetPasswordToken:{type:n.STRING,unique:!0},resetPasswordExpires:{type:n.DATE},lastSignIn:{type:n.DATE}},{paranoid:!0,instanceMethods:{authenticate:function(e){return o.compareSync(e,this.password)},hashPassword:function(e){var t=o.genSaltSync(10);return o.hashSync(e,t)}}});return r.beforeCreate(t),r.beforeUpdate(t),r}},function(e,t){e.exports=require("bcrypt")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=r(31),s=n(o),a=r(12);e.exports.pagenation=function(e){function t(e){var t=(0,s.default)(e).map(function(t){return t+"="+e[t]}).join("&");return a.endPoint+r+"?"+t}e.req=e.req||{};var r=e.req._parsedOriginalUrl.pathname||"",n=e.req.query||{},o=e.size||20,i=parseInt(n.page)||0,u=e.totalCount||0,c=e.currentRowCount||0,l=null,p=null;if(0!==i){var d=i-o;d=d<0?0:d,n.page=d,l=t(n)}return c==o&&i+c!=u&&(n.page=i+o,p=t(n)),{prev:l,next:p}}},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t,r){"use strict";var n=r(33);e.exports=function(e){return e.route("/api/route2").get(n.getRoute2).post(n.makeItem),e.route("/api/route2/:itemId").delete(n.deleteItem),e}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=r(18),s=n(o),a=r(20),i=r(19),u=a.Route2;e.exports.getRoute2=function(e,t,r){u.findAndCountAll({attributes:["id","name","content","createdAt"],order:"id desc"}).then(function(e){e={id:e.id,count:e.count,items:e.rows},t.send(e)}).catch(r)},e.exports.makeItem=function(e,t,r){var n=e.body.name,o=e.body.chat;u.create({name:n,content:o}).then(function(e){t.send(e)}).catch(r)},e.exports.deleteItem=function(e,t,r){i(s.default.mark(function n(){var o;return s.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o=e.params.itemId,n.next=4,u.destroy({where:{id:o}});case 4:t.end(),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),r(n.t0);case 10:case"end":return n.stop()}},n,this,[[0,7]])}))}},function(e,t,r){"use strict";var n=r(35);e.exports=function(e){return e.route("/api/stack").get(n.getStack).post(n.createStack),e}},function(e,t,r){"use strict";var n=r(20),o=n.Profile;e.exports.getStack=function(e,t,r){o.findAndCountAll({attributes:["id","skill","type","description","mastery"]}).then(function(e){return t.send(e.rows)}).catch(function(e){return r(e)})},e.exports.createStack=function(e,t,r){e.checkBody("skill","스킬을 입력해주세요").notEmpty(),e.checkBody("type","종류를 입력해주세요").notEmpty(),e.checkBody("description","설명을 입력해주세요").notEmpty(),e.checkBody("mastery","숙련도를 입력해주세요").notEmpty();var n=e.validationErrors();if(n)return void t.send(n[0]);var s=e.body.skill,a=e.body.type,i=e.body.description,u=e.body.mastery;o.create({skill:s,type:a,description:i,mastery:u}).then(function(e){return t.send(e)}).catch(function(e){return r(e)})}},function(e,t,r){"use strict";var n=r(37);e.exports=function(e){return e.route("/auth/login").post(n.login),e}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=r(13),s=n(o);e.exports=(0,s.default)({},r(38),r(40),r(41),r(42))},function(e,t,r){"use strict";function n(){var e=s.genSaltSync(10);return s.hashSync(i.tokenSecret,e)}var o=r(39),s=r(29),a=r(10),i=r(15),u=r(20),c=u.RefreshToken;e.exports.login=function(e,t,r){e.checkBody("userEmail","이메일을 입력해주세요").notEmpty(),e.checkBody("password","패스워드를 입력해주세요").notEmpty();var s=e.validationErrors();s?t.send(s[0]):o.authenticate("local",function(o,s,i){o||!s?r({message:i.message||o.message,statusCode:401}):!function(){var o=n();c.create({refreshToken:o,expiredAt:Date.now()+2592e6,UserId:s.id}).then(function(){var n={id:s.id,email:s.email},i=a.generateToken(n,e.hostname,r);t.send({refreshToken:o,jwToken:i,user:s.email})})}()})(e,t,r)}},function(e,t){e.exports=require("passport")},function(e,t){"use strict"},function(e,t){"use strict";"추후 가능할 때 추가 작업 (user info 관련된 부분)"},function(e,t){"use strict"},function(e,t,r){"use strict";e.exports=function(){r(44)()}},function(e,t,r){"use strict";var n=r(39),o=r(45).Strategy,s=r(20),a=s.User;e.exports=function(){n.use(new o({usernameField:"userEmail",passwordField:"password"},function(e,t,r){a.findOne({where:{email:e}}).then(function(e){return e?e.authenticate(t)?r(null,e):r(null,!1,{message:"비밀번호가 틀렸습니다."}):r(null,!1,{message:"등록된 아이디가 아닙니다."})}).catch(function(e){console.log(e),r(e)})}))}},function(e,t){e.exports=require("passport-local")},function(e,t,r){"use strict";var n=r(1),o=r(47);e.exports={target:"node",externals:[o()],node:{__dirname:!1},entry:["./server.js","webpack-dev-server/client?http://0.0.0.0:3002","webpack/hot/only-dev-server"],output:{path:"/",filename:"app.js"},devServer:{hot:!0,filename:"app.js",publicPath:"/",historyApiFallback:!0,contentBase:"./dist",proxy:{"**":"http://localhost:8000"}},plugins:[new n.optimize.OccurenceOrderPlugin,new n.HotModuleReplacementPlugin,new n.NoErrorsPlugin],module:{loaders:[{test:/\.js$/,loader:"babel",exclude:/node_modules/,query:{cacheDirectory:!0,presets:["es2015"]}}]}}},function(e,t){e.exports=require("webpack-node-externals")}]);
//# sourceMappingURL=app.04ecd64753a4fbca8c95.bundle.js.map